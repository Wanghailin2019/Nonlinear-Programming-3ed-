# Chapter 1 无约束优化：基本方法

目录：

1.1 最优性条件

​	1.1.1 变分思想

​	1.1.2 主要的最优性条件

1.2 梯度方法——收敛

​	1.2.1 下降方向和步长规则

​	1.2.2 收敛结果

1.3 梯度方法——收敛速率

​	1.3.1 局部分析方法

​	1.3.2 条件编号的作用

​	1.3.3 收敛率结果

1.4 牛顿法及其变体

​	1.4.1 修改的Cholesky分解

​	1.4.2 置信域方法

​	1.4.3 牛顿法的变体

​	1.4.4 最小二乘法和Gauss-Newton方法

1.5 注释和参考文献



优化的数学模型通常可以由约束集$$X$$和将$X$的元素映射为实数的成本函数$f$表示。集合$X$由可用的决策$x$组成，成本$f(x)$是选择决策$x$的不受欢迎程度的标量度量。我们想要找到一个最优决策，即一个$x^*\in X$使得：
$$
f(x^*)\leq f(x), \forall x \in X.
$$


在本书中，我们关注每个决策$x$是一个 n 维向量的情况；也就是说，$x$是实数的 n 元组$(x_1,...,x_n)$。因此，约束集 $X$ 是$\Re^n$（n 维欧几里得空间）的子集。(具体可以参考附录A中相关的术语和标记惯例)

刚刚提到的优化问题非常广泛，并且包含几个重要类别的特殊情况，这些问题具有广泛不同的结构。我们的重点将放在非线性规划问题上，因此让我们提供一些关于这些问题的特征以及它们与其他类型优化问题的关系的方向。

**连续和离散问题**

也许优化问题最重要的特征是它是*连续的还是离散的*。连续问题是约束集$X$是无限的并且具有“连续”特征的问题。连续问题的典型示例是那些没有约束的问题，即 $X = \Re^n$或 $X$由某些方程和不等式指定。通常，使用微积分和凸性数学分析连续问题。

离散问题基本上是那些不连续的问题，通常是因为约束集$X$的有限性。典型的例子是组合问题，例如在调度、路线规划和匹配中出现。另一种重要的离散问题类型是整数规划，其中存在一个约束，即优化变量必须只取某个范围内的整数值（例如 0 或 1）。离散问题通过组合数学和其他特殊方法来解决，其中一些与连续问题有关。

非线性规划，即成本函数$f$是非线性的或约束集$X$由非线性方程和不等式指定的情况，完全属于连续问题类别。其他几种重要类型的优化问题具有更多的混合特征，但与非线性规划密切相关。

特别是线性规划问题，其中$f$是线性的，$X$ 是由线性不等式约束指定的多面体，具有许多连续问题的特征。但是，它们也部分具有组合结构：根据基本定理 [Prop.附录 B 中的 B.20(c)] 中，线性规划的最优解可以通过在多面体$X$的（有限）组极值点中搜索来找到。因此，对最优值的搜索可以限制在这个有限集内，实际上，最流行的线性规划方法之一，单纯形法，就是基于这个思想。然而，我们注意到其他重要的线性规划方法，例如将在第5.1节讨论的内点方法，以及第6和第7章中的一些对偶方法，依赖于线性规划的连续结构并且基于非线性规划思想。

具有强混合特征的另一类主要问题是网络优化。这里的约束集$X$是一个多面体，它是根据由节点和有向弧组成的图来定义的。这个约束集的显著特点是它的极值点具有整数分量，这对于一般多面体来说是不正确的。因此，重要的组合或整数规划问题，例如一些匹配和最短路径问题，可以嵌入并解决在连续网络优化框架中。

我们在本书中的目标是关注非线性规划问题、它们的连续性以及相关的数学分析。但是，我们将保留对其他部分具有离散特征的广泛类别的问题的看法。特别是，我们将广泛考虑线性规划与非线性规划方法密切相关的那些方面，例如内点法和多面体凸性（参见第5.1节，附录B.3和B.4） 

.我们将在第 3.1, 6.8, 6.4.3节讨论网络优化问题的各个方面，这些问题涉及到它们的连续性和离散性。在作者的网络优化教科书中可以找到更广泛的处理，它跨越了连续优化和离散优化之间的界限[Ber98]。

最后，我们将讨论整数规划和组合优化的一些主要方法，例如分支定界和拉格朗日松弛，它们依赖于对偶性和连续优化子问题的解决方案（参见第 6.5 节和第 7.5 节）。

让我们也注意到，在方法论上存在分歧一类连续问题。一方面，我们遇到了成本函数$f$是可微的，甚至是两次可微的问题。 这允许一个基于微积分的分析，这将是我们第 1-5 章分析的主要方法。 另一方面，我们有的问题，其中$f$是非可微但是凸的。 这需要依赖凸性（而不是可微性）的分析线。 这将是我们在第 6 章和第 7 章中的主要方法。当然，可微性在凸问题的背景下也可以发挥重要作用。此外，不可微（凸或非凸）问题通常可以通过使用平滑变换有效地转换为可微问题，我们将在后面解释（见第 2.7 节）。

**无约束可微优化：概述**

这一章和下一章，我们集中于无约束可微非线性规划问题。这些问题的成本函数$f$至少是一阶连续可微，$X = \Re^n$:
$$
minimize\ f(x) \\
subject\ to\ x \in \Re^n
$$
$f$ 的一阶和二阶导数在通过必要和充分条件表征最优解中起着重要作用，这是第 1.1 节的主要主题。一阶和二阶导数也是计算近似最优解的数值算法的核心。此类算法种类繁多，具有丰富的理论，将在 1.2-1.4 节和第二章中讨论。

在第二章中，我们将也讨论2中类型的特殊问题结构。第一个是累加成本函数（additive cost function）：
$$
f(x) = \sum^m_{i=1}f_i(x),
$$
其中函数分量$f_i$是可微的。在信号处理、机器学习和神经网络训练中出现的许多感兴趣的问题都有这种形式。对于此类问题，通常使用增量算法方法，该方法涉及沿函数$f_i$的梯度的顺序步骤，在处理每个$f_i$后对 $x$进行中间调整。我们将在 2.4 节讨论这种类型的算法及其应用。这些方法包括第 1 章中讨论的梯度、牛顿和高斯-牛顿方法的增量版本。在许多重要的上下文中，某些分量 $f_i$ 是不可微的。此类问题的增量方法也将在第 7 章中讲述。在第 2.5 节中，我们还将讨论分布式异步计算设置中的各种方法，涉及多个处理器和处理器之间的通信延迟。

我们将讨论的第二种特殊结构是最优控制问题，它涉及离散时间动态系统（见第 2.6 节）。这些是潜在的非常大维度的问题，其结构可用于方便地实现梯度和类牛顿方法。这些问题的一个重要特征是可以使用动态系统结构经济地计算梯度和牛顿方向。 

加性成本（additive cost）和最优控制问题也出现在约束环境中，有时我们将在后续章节中暂停讨论约束变量。主要出现在有约束环境中的第三种特殊结构是网络优化问题（network optimization problem）。在讲述相关有约束优化算法之后，我们将在3.1和3.8节讨论这些问题。

我们在本章中的分析将侧重于解释各种方法的基本属性，主要是它们的收敛性和收敛速度。使用二次问题（quadratic problem）可以充分和直观地解释这些属性中的许多。基本原理是，正定二次成本函数的算法的行为通常是其在 Hessian 矩阵为正定的最小值附近的二阶可微成本函数行为的正确预测器。由于梯度在该最小值处为零，因此正定二次项在级数展开中支配其他项，并且该方法的渐近行为不依赖于高于 2 的阶项。这种分析是一些最广泛使用的无约束优化方法的基础，例如牛顿法、高斯牛顿法、准牛顿法和共轭方向法。然而，当 Hessian 最小为奇异时，这些方法的基本原理被削弱，因为在这种情况下，三阶和更高阶项可能变得重要。那么最好使用主要依赖于成本函数的一阶可微性的一阶方法和分析。与这个想法一致，我们将在本章和后面的章节中讨论一阶和二阶方法，并解释每种方法最适合的情况。

## 1.1 最优性条件

### 1.1.1 变分思想

非线性规划最优性条件的主要思想通常允许简单的解释，尽管它们的详细证明有时很乏味。出于这个原因，我们选择在本小节中首先非正式地讨论这些想法，并将结果和证明的详细陈述留给下小节。

**局部和全局最小（Local and Global Minima）**

如果向量 $x^*$ 不比其邻居差，则向量 $x^*$ 是函数$f:\Re^n \to \Re$ 的无约束局部最小值；也就是说，如果存在一个$\epsilon > 0$使得:
$$
f(x^*) \leq f(x),\ \ \ \forall x \in \Re^n with \parallel x-x^* \parallel < \epsilon
$$
注：除非特殊说明，$\parallel\ x\parallel = \sqrt{x'x}$是欧几里得范数。附录A中描述了相关的数学记号和术语。

<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="pictures\figure1-1-1.png" width="65%" alt="">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">无约束局部和全局最小（一维）</div>
</center>





如果向量$x^*$不比其他所有的向量差，则向量$x^*$是函数$f$的无约束全局最小值；也就是：
$$
f(x^*) \leq f(x), \ \ \ x \in \Re^n
$$
如果上面对应的不等式对于$x\ne x^*$是严格的，则无约束的局部或全局最小值$a^*$被称为严格的。图 1.1.1 说明了这些定义。

局部和全局最小值的定义可以扩展到$f$的最小化受约束集 $X\subset \Re^n$ 约束的情况，其中的点被称为可行的(feasible)。特别是，我们说$x^*$是$f$在 $X$上的局部最小值，如果$x^* \in X $ 并且存在$\epsilon \gt 0$使得
$$
f(x^*) \leq f(x), \ \ \ \forall x \in X \ \ with \ \ ||x-x^*|| \lt \epsilon;
$$


见图 1.1.2。$X$上的全局和严格最小值的定义是类似的。

<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="pictures\figure1-1-2.png" width="65%" alt="">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">在约束集X上的函数f的局部和全局最小</div>
</center>




局部和全局最大值的定义类似。特别的，如果$a^*$是函数 $-f$ 的无约束局部（全局）最小值，那么$a^*$是$f$的无约束局部（全局）最大值。

**最优性的必要条件**

如果成本函数是可微的，我们可以使用梯度来比较向量的成本与其近邻的成本。特别是，我们考虑来自给定向量 $x^*$的小变化$\Delta x$，它近似地，直到一阶，产生成本变化：
$$
f(x^*+\Delta x)-f(x^*) \approx \nabla f(x^*)\Delta x,
$$

二阶的成本变化：
$$
f(x^*+\Delta x)-f(x^*) \approx \nabla f(x^*)\prime \Delta x + \frac{1}{2}\Delta x\prime \nabla^2f(x^*)\Delta x.
$$
我们期望如果 $x^*$ 是一个无约束的局部最小值，则由于小变化 $\Delta x$ 引起的一阶成本变化是非负的：
$$
\nabla f(x^*)\prime \Delta x = \sum^n_{i=1}\frac{\partial f(x^*)}{\partial x_i} \Delta x_i \ge 0.
$$

特别是，通过将 $\Delta x$ 取为单位坐标向量的正负倍数（除一个等于 1 的坐标外，所有坐标都等于 0），我们分别得到 $\part f(x^*)/\part x_i\ge 0$ 和 $$\part f(x^*)/\part x_i\le 0$$，分对于所有$i=1,...,n$。等效地，我们有必要条件
$$
\nabla f(x^*)=0,
$$


【最初由费马于 1637 年在没有证明的短篇论文“Methodus as Disquirendam Maximam et Minimam”中提出】。这个条件在 Prop. 1.1.1 中得到正式证明，在下一小节中给出。

在局部最小值 $x^*$ 处，对于小的变化 $\Delta x$，条件 $\nabla f(x^*)\Delta x\ge0$ 应该成立的想法更广泛地适用，包括凸约束集 $X$ 的问题，比如它采用如下形式：
$$
\nabla f(x^*)\prime (x-x^*)\ge 0, \ \ \forall x \in X
$$
 对于凸成本函数的情况，此条件将在 Prop. 1.1.2 中给出。在第 3 章中，它将成为本章计算方法的约束版本的基础。

我们还期望成本函数的二阶微分对于一个小的变换$\Delta x$也是非负的：
$$
\nabla f(x_*)\prime\Delta x + \frac{1}{2}\Delta x\prime\nabla^2f(x^*)\Delta x \ge 0.
$$
因为$\nabla f(x^*)\prime\Delta x = 0$，我们可以得到：
$$
\Delta x\prime\nabla^2f(x^*)\Delta x \ge 0, \ \  \forall \Delta x \in \Re^n
$$
也就是说：
$$
\nabla^2f(x^*)是半正定的
$$
我们将在下一小节（Prop. 1.1.1）中证明这个必要条件。附录 A 回顾了正定矩阵和半正定矩阵的定义和性质。

在下文中，我们将满足条件 $\nabla f(x^*)=0$ 的向量 $x^*$ 称为*静止点*。

**凸成本函数的情况**

凸性在非线性规划中起着非常重要的作用。一个原因是当成本函数 $f$ 是凸的时，局部最小值和全局最小值之间没有区别；每个局部最小值也是全局的。这个想法如图 1.1.3 所示，形式证明在 Prop. 1.1.2 中给出。

<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="pictures\figure1-1-3.jpg" width="55%" alt="">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">图1.1.3 </div>
</center>



另一个重要的事实是，如果 $f$ 是凸的，则一阶条件 $\nabla f(x^*)=0$ 也足以达到最优性。这在Prop. 1.1.3 中确立。证明基于凸函数 $f$ 的基本性质：基于梯度的点 $x^*$的线性逼近，即 
$$
f(x^*)+\nabla f(x^*)\prime (x-x^*),
$$


 低估了 $f(x)$，所以如果 $\nabla f(x^*)=0$，那么对于所有 $x,f(x^*)\le f(x)$（参见附录 B 中的 Prop. B.3）。

**最优性的充分条件**

如果 $f$ 不是凸的，则一阶和二阶必要条件可能无法保证 $x^*$ 的局部最优性。如图 1.1.4 所示。然而，通过加强二阶条件，我们得到了最有性的充分条件。

<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="pictures\figure1-1-4.jpg" width="65%" alt="">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">图1.1.4 </div>
</center>

特别的，考虑向量$x^*$满足一阶最优性的必要条件：
$$
\nabla f(x^*)=0, \tag{1.1}
$$
并且同时满足下面的二阶最优性的必要条件的加强形式：
$$
\nabla^2 f(x^*): positive\ definite,\tag{1.2}
$$
(比如：Hessian矩阵式正定的而不是半正定)。那么对于所有的$\Delta x \ne 0$ 我们有：
$$
\Delta x\prime\nabla^2 f(x^*) \Delta x > 0,
$$
隐含表示函数$f$在处的二阶导数的非零的小的变化量$\Delta x$是正值。

意味着在 $x^*$ 处，由于小的非零变化 $\Delta x$ 导致的 $f$ 的二阶变化是正的。因此，$f$ 趋向于随着 $x^*$ 的小幅偏移而严格增加，这表明上述条件 (1.1) 和 (1.2) 足以满足 $x^*$ 的局部最优性。这确实在 Prop. 1.1.5 中确立。

不满足正定充分条件（1.2）的局部最小值称为*奇异值*；否则它们被称为非奇异的。奇异的局部最小值更难处理有两个原因。首先，在 $f$ 没有凸性的情况下，它们的最优性无法使用易于验证的充分条件来确定。其次，在它们附近，最常用的优化算法的行为往往很慢或不稳定，正如我们将在后续部分中看到的那样。

**二次成本函数** 

考虑二次函数：



其中 Q 是对称的 n x n 矩阵，b 是 Pr 中的向量。如果 a* 是 f 的局部最小值，则根据必要的最优性条件，我们必须有 Vf(2*) = 0x* - b = 0 V2f(2*) = Q ：半正定。因此，如果 Q 不是半正定的，则 f 可以没有局部最小值。如果 Q 是半正定的，f 是凸的 Prop. B.4(d) of Annex B]，所以任何满足一阶条件 Vf(a*) = Qa* b = 0 的向量 a* 都是 f 的全局最小值。另一方面，如果 Q 是奇异的，则可能不存在方程 Vf(r*) = Qa* - 6 = 0 的解。然而，如果 Q 是正定的（因此根据附录 A 的 Prop. A.20 是可逆的），方程 @x* b = 0 可以唯一求解，向量 2* = Q-16 是唯一的全局最小值.这与即将给出的 Prop. 1.1.3(a) 一致，该 Prop. 1.1.3(a) 断言严格凸函数最多可以有一个全局最小值 If 是严格凸的当且仅当 Q 是正定的；附录 B 的提案 B.4(d)]。图 1.1.5 说明了所考虑的各种特殊情况。二次成本函数在非线性规划中很重要，因为它们在应用程序中经常出现，但它们也很重要，还有另一个原因。从局部最小值附近的二阶展开





